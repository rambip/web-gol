<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=0.7">
		<meta charset="utf-8">
		<link rel="stylesheet" href="/style.css">
		<title>games of life</title>
	</head>
	<body>
		<div class="h-box">
			<div style="width: 100%">
				<h2 style="text-align: center">Games of life</h2>
			</div>
		</div>
        <div class="parent-box">
            <div style="margin:15px"><canvas id="canvas"></canvas></div>
		</div>
		<div class="h-box" style="position: absolute; bottom: 5px;">
			<button id="random" style="margin: 15px; margin-bottom: 0;">random rule</button>
			<div class="v-box" style="width: 300px">
				<div class="h-box">
					<div style="width:100px;"></div>
					<div class="h-box" style="justify-content: space-around; width: 100%"><div>0</div><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div></div>
				</div>
				<div class="h-box">
					<div style="width:100px; text-align: center">birth</div>
					<div class="h-box" id="birth" style="justify-content: space-around; width: 100%"><input type="checkbox"><input type="checkbox"><input type="checkbox"><input type="checkbox" checked="checked"><input type="checkbox"><input type="checkbox"><input type="checkbox"><input type="checkbox"><input type="checkbox"></div>
				</div>
				<div class="h-box">
					<div style="width:100px; text-align: center">survival</div>
					<div class="h-box" id="survive" style="justify-content: space-around; width: 100%"><input type="checkbox"><input type="checkbox"><input type="checkbox" checked="checked"><input type="checkbox" checked="checked"><input type="checkbox"><input type="checkbox"><input type="checkbox"><input type="checkbox"><input type="checkbox"></div>
				</div>
			</div>
			<button id="change" style="margin: 15px; margin-bottom: 0; background-color: #8c4392;">test rule</button>
			<div style="margin: 5px"></div>
		</div>
		


		<noscript>This page contains webassembly and javascript content, please enable javascript in your browser.</noscript>		
                <script type="module">
                        import init from './pkg/game_of_life.js';
                        import {Universe} from './pkg/game_of_life.js';

                        // init canvas size
                        const width = Math.round(document.documentElement.clientWidth/2-20);
                        const height = Math.round(document.documentElement.clientHeight/2-100);

                        // init canvas and draw utilities
                        const canvas = document.getElementById("canvas"); canvas.width = width*2; canvas.height=height*2;
                        const ctx = canvas.getContext('2d');

                        const birth_rule = document.getElementById("birth").children;
                        const survive_rule = document.getElementById("survive").children;

                        document.getElementById("change").onclick = new_universe;
                        document.getElementById("random").onclick = random_rule;

                        let image = new ImageData(width*2, height*2);
            let demo;

                        function new_universe(){
                let birth = ""; let survive = "";
                                for (let i = 0; i < 9; i++) {
                                        if (birth_rule[i].checked) birth += i.toString();
                                        if (survive_rule[i].checked) survive += i.toString();
                                }

                                demo = new Universe(birth, survive, width, height);

                for (var y = height/4; y < height*3/4; y++) {
                                        for (var x = width/4; x < width*3/4; x++) {
                                                if (Math.random() > .6) {
                            demo.add_cell(x, y);
                        }
                                        }
                                }
                        }

                        function random_rule(){
                                for (let i = 0; i < 9; i++) {
                                        birth_rule[i].checked = Math.random()>0.8;
                                        survive_rule[i].checked = Math.random()>0.7;
                                }
                        }

            function frame_loop(x){
                demo.step();
                demo.draw(ctx)
                setTimeout(() => requestAnimationFrame(frame_loop), 20);
            }

                        function run(){
                demo = new Universe("3", "23", width, height);
                for (var y = height/4; y < height*3/4; y++) {
                                        for (var x = width/4; x < width*3/4; x++) {
                                                if (Math.random() > .6) {
                            demo.add_cell(x, y);
                        }
                                        }
                                }

                frame_loop()
            }

                        init().then(run);
                </script>
	</body>
</html>
